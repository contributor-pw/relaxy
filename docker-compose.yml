services:
  api-service:
    image: httpd:2.4 # Using httpd as a placeholder
    container_name: api-service
    networks:
      - net

  webapp-service:
    image: httpd:2.4 # Using httpd as a placeholder
    container_name: webapp-service
    networks:
      - net

  nginx:
    image: nginx:latest
    container_name: nginx
    restart: unless-stopped
    ports:
      - '80:80'
      - '443:443'
    environment:
      - ROOT_DOMAIN
      - SUBDOMAINS
      - CERT_NAME
    volumes:
      - ./nginx-entrypoint.sh:/nginx-entrypoint.sh
      - ./data/certbot/conf:/etc/letsencrypt
      - ./data/certbot/www:/var/www/certbot
    command: ["/bin/sh", "/nginx-entrypoint.sh"]
    depends_on:
      - api-service
      - webapp-service
    networks:
      - net

  certbot:
    image: certbot/certbot
    container_name: certbot
    environment:
      - ROOT_DOMAIN
      - SUBDOMAINS
      - EMAIL
    volumes:
      - ./data/certbot/conf:/etc/letsencrypt
      - ./data/certbot/www:/var/www/certbot
    networks:
      - net

networks:
  net:
    external: true
